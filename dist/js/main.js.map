{"version":3,"sources":["main.js"],"names":["$","document","ready","active","removeClass","parent","addClass","getUserList","submit","e","preventDefault","formData","FormData","createUser","reader","FileReader","onload","attr","target","result","change","input","files","readAsDataURL","hide","show","createRoom","getRoomList","apiRequest","method","action","params","callback","isFormData","constructor","name","append","auth","user_id","session_id","ajax","type","data","url","processData","contentType","success","response","JSON","parse","console","log","message","error","newAlert","alert","isError","check","find","text","fadeIn","unbind","click","fadeOut","empty","each","body","i","obj","id","tr","username","role","timestamp","button","td","deleteUser","target_id","cleanedList","uncleanedList","image","thumb","level","department","number","description","cleaned","createButton","priv","length","icon"],"mappings":"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","file":"main.js","sourcesContent":["/*\n  Created by: Christopher Gauffin\n  Description: Core functionality for hotel admin, contains functions for API requests and list generation of users and rooms\n*/\n\n$(document).ready(function(){\n    if(active) {\n      $(\"#menu li.active\").removeClass(\"active\");\n      $(\"#menu a[href='?\"+active+\"']\").parent(\"li\").addClass(\"active\");\n    }\n\n    switch(active) {\n      case \"users\":\n        getUserList();\n        \n        $(\"#user_form\").submit(function(e) {\n          e.preventDefault();\n\n          var formData = new FormData(this);\n          createUser(formData);\n        });\n      break;\n\n      case \"newroom\":\n        var reader = new FileReader();\n        reader.onload = function (e) {\n          $('#room_img img').attr('src', e.target.result);\n        };\n\n        $(\"#room_img_input\").change(function() {\n          var input = $(this)[0];\n\n          if (input.files && input.files[0]) {\n            reader.readAsDataURL(input.files[0]);\n            $(\"#room_img i\").hide();\n            $(\"#room_img img\").show();\n          } else {\n            $(\"#room_img i\").show();\n            $(\"#room_img img\").hide();\n          }\n        });\n\n        $(\"#room_form\").submit(function(e) {\n          e.preventDefault();\n\n          var formData = new FormData(this);\n          createRoom(formData);\n        });\n      break;\n\n      case \"rooms\":\n        getRoomList();\n      break;\n    }\n});\n\nfunction apiRequest(method, action, params, callback = null){\n\n  var isFormData = params.constructor.name === \"FormData\";\n\n  if(isFormData){\n    params.append(\"action\", action);\n  } else {\n    params.action = action;\n  }\n\n  if(typeof auth.user_id !== \"undefined\" && typeof auth.session_id !== \"undefined\"){\n    if(isFormData){\n      params.append(\"user_id\", auth.user_id);\n      params.append(\"session_id\", auth.session_id);\n    } else {\n      params.user_id = auth.user_id;\n      params.session_id = auth.session_id;\n    }\n  }\n\n  $.ajax({\n    type: method,\n    data: params,\n    url: \"api.php\",\n    processData: !isFormData,\n    contentType: isFormData ? false : \"application/x-www-form-urlencoded\",\n    success: function(response) {\n      try {\n        if( callback != null ) callback(JSON.parse(response));\n      } catch(e) {\n        console.log(e.message);\n        console.log(response);\n      }\n    },\n    error: function(response){\n      console.log(response);\n    }\n  });\n}\n\n\nfunction newAlert(alert, isError, message) {\n  alert.addClass(isError ? \"alert-danger\" : \"alert-success\");\n  alert.removeClass(isError ? \"alert-success\" : \"alert-danger\");\n  var check = alert.find(\".check\");\n  var error = alert.find(\".error\");\n\n  if(isError) {\n    error.show();\n    check.hide();\n  } else {\n    error.hide();\n    check.show();\n  }\n\n  alert.find(\".message\").text(message);\n  alert.fadeIn(300);\n\n  alert.unbind(\"click\").click(function() {\n    alert.fadeOut(300);\n  })\n}\n  \n  \nfunction getUserList(){\n  $(\"#user_table tbody\").empty();\n\n  apiRequest(\"GET\", \"getUsers\", {}, function(response){\n      $.each(response.body, function(i, obj){\n          if(obj.id == auth.user_id) return;\n          var tr = $(\"<tr data-id='\"+obj.id+\"'></tr>\");\n  \n          tr.append(\"<td>\"+obj.name+\"</td>\");\n          tr.append(\"<td>\"+obj.username+\"</td>\");\n\n          var role = \"Städpersonal\";\n          if(obj.role == 1) role = \"Administratör\";\n\n          tr.append(\"<td>\"+role+\"</td>\");\n          tr.append(\"<td>\"+obj.timestamp+\"</td>\");\n\n          var button = $(\"<button class='btn btn-primary delete'><i class='fa fa-trash'></i></button>\");\n          var td = $(\"<td></td>\");\n\n          td.append(button);\n          tr.append(td);\n          \n          $(\"#user_table tbody\").append(tr);\n      });\n\n      $(\"#user_table .delete\").click(function() {\n        var id = $(this).parent(\"td\").parent(\"tr\").data(\"id\");\n        deleteUser(id);\n      })\n  });\n}\n\nfunction deleteUser(user_id) {\n  console.log(user_id);\n  apiRequest(\"POST\", \"deleteUser\", {target_id: user_id}, function(response) {\n    console.log(response);\n    if(response.success) {\n      newAlert($(\"#alert\"), false, response.message);\n      getUserList();\n    } else {\n      newAlert($(\"#alert\"), true, response.message);\n    }\n  });\n}\n\nfunction createUser(formData) {\n  apiRequest(\"POST\", \"createUser\", formData, function(response) {\n    if(response.success) {\n      newAlert($(\"#alert\"), false, response.message);\n      getUserList();\n    } else {\n      newAlert($(\"#alert\"), true, response.message);\n    }\n  });\n}\n\n\nfunction createRoom(formData) {\n  apiRequest(\"POST\", \"createRoom\", formData, function(response) {\n    console.log(response);\n    if(response.success) {\n      newAlert($(\"#alert\"), false, response.message);\n    } else {\n      newAlert($(\"#alert\"), true, response.message);\n    }\n  });\n}\n\nfunction getRoomList() {\n  apiRequest(\"GET\", \"getRooms\", {}, function(response) {\n    if(!response.success) {\n      console.log(response);\n      return;\n    }\n\n    var cleanedList = $(\"#cleaned_rooms table tbody\");\n    var uncleanedList = $(\"#uncleaned_rooms table tbody\");\n    cleanedList.empty();\n    uncleanedList.empty();\n\n    $.each(response.body, function(i, obj){\n      var tr = $(\"<tr data-id='\"+obj.id+\"'></tr>\");\n\n      tr.append(\"<td><img src='\"+obj.image.thumb+\"'</td>\")\n      tr.append(\"<td>\"+obj.level+obj.department+obj.number+\"</td>\");\n      tr.append(\"<td>\"+obj.description+\"</td>\");\n\n      var td = $(\"<td></td>\");\n\n      if(obj.cleaned) {\n        td.append(createButton(\"clean\", \"check\"));\n      } else {\n        td.append(createButton(\"unclean\", \"remove\"));\n      }\n\n      if(priv) {\n        td.append(createButton(\"change\", \"edit\"));\n        td.append(createButton(\"delete\", \"trash\"));\n      }\n      \n      tr.append(td);\n      \n      if(obj.cleaned > 0) {\n        cleanedList.append(tr);\n      } else {\n        uncleanedList.append(tr);\n      }\n    });\n\n    if(cleanedList.length) {\n      $(\"#cleaned_rooms .room-table\").show();\n      $(\"#cleaned_rooms .no-list-text\").hide();\n    } else {\n      $(\"#cleaned_rooms .room-table\").hide();\n      $(\"#cleaned_rooms .no-list-text\").show();\n    }\n\n    if(uncleanedList.length) {\n      $(\"#uncleaned_rooms .room-table\").show();\n      $(\"#uncleaned_rooms .no-list-text\").hide();\n    } else {\n      console.log(\"asdf\");\n      $(\"#uncleaned_rooms .room-table\").hide();\n      $(\"#uncleaned_rooms .no-list-text\").show();\n    }\n  });\n}\n\nfunction createButton(action, icon) {\n  return $(\"<button class='btn btn-primary \"+action+\"'><i class='fa fa-\"+icon+\"'></i></button>\");\n}"]}