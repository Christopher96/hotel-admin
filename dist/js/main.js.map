{"version":3,"sources":["main.js"],"names":["$","document","ready","active","removeClass","parent","addClass","getUserList","submit","e","preventDefault","formdata","FormData","createUser","newAlert","alert","isError","message","check","find","error","show","hide","text","fadeIn","unbind","click","fadeOut","apiRequest","method","action","params","callback","isFormData","constructor","name","append","auth","user_id","session_id","ajax","type","data","url","processData","contentType","success","response","JSON","parse","console","log","empty","each","body","i","obj","id","tr","username","role","timestamp","button","td","deleteUser","target_id"],"mappings":"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","file":"main.js","sourcesContent":["/*\n  Created by: Christopher Gauffin\n  Description: Core functionality for hotel admin, contains functions for API requests and list generation of users and rooms\n*/\n\n$(document).ready(function(){\n    if(active) {\n      $(\"#menu li.active\").removeClass(\"active\");\n      $(\"#menu a[href='?\"+active+\"']\").parent(\"li\").addClass(\"active\");\n    }\n\n    switch(active) {\n      case \"users\":\n        getUserList();\n        \n        $(\"#user_form\").submit(function(e) {\n          e.preventDefault();\n\n          var formdata = new FormData(this);\n          createUser(formdata);\n        });\n      break;\n    }\n});\n\nfunction newAlert(alert, isError, message) {\n  alert.addClass(isError ? \"alert-danger\" : \"alert-success\");\n  alert.removeClass(isError ? \"alert-success\" : \"alert-danger\");\n  var check = alert.find(\".check\");\n  var error = alert.find(\".error\");\n\n  if(isError) {\n    error.show();\n    check.hide();\n  } else {\n    error.hide();\n    check.show();\n  }\n\n  alert.find(\".message\").text(message);\n  alert.fadeIn(300);\n\n  alert.unbind(\"click\").click(function() {\n    alert.fadeOut(300);\n  })\n}\n  \nfunction apiRequest(method, action, params, callback = null){\n  \n    var isFormData = params.constructor.name === \"FormData\";\n  \n    if(isFormData){\n      params.append(\"action\", action);\n    } else {\n      params.action = action;\n    }\n  \n    if(typeof auth.user_id !== \"undefined\" && typeof auth.session_id !== \"undefined\"){\n      if(isFormData){\n        params.append(\"user_id\", auth.user_id);\n        params.append(\"session_id\", auth.session_id);\n      } else {\n        params.user_id = auth.user_id;\n        params.session_id = auth.session_id;\n      }\n    }\n  \n    $.ajax({\n      type: method,\n      data: params,\n      url: \"php/api.php\",\n      processData: !isFormData,\n      contentType: isFormData ? false : \"application/x-www-form-urlencoded\",\n      success: function(response) {\n        try {\n          if( callback != null ) callback(JSON.parse(response));\n        } catch(e) {\n          console.log(e.message);\n          console.log(response);\n        }\n      },\n      error: function(response){\n        console.log(response);\n      }\n    });\n  }\n  \n  \nfunction getUserList(){\n    $(\"#user_table tbody\").empty();\n\n    apiRequest(\"GET\", \"getUsers\", {}, function(response){\n        $.each(response.body, function(i, obj){\n            if(obj.id == auth.user_id) return;\n            var tr = $(\"<tr data-id='\"+obj.id+\"'></tr>\");\n    \n            tr.append(\"<td>\"+obj.name+\"</td>\");\n            tr.append(\"<td>\"+obj.username+\"</td>\");\n\n            var role = \"Städpersonal\";\n            if(obj.role == 1) role = \"Administratör\";\n\n            tr.append(\"<td>\"+role+\"</td>\");\n            tr.append(\"<td>\"+obj.timestamp+\"</td>\");\n\n            var button = $(\"<button class='btn btn-primary delete'><i class='fa fa-trash'></i></button>\");\n            var td = $(\"<td></td>\");\n\n            td.append(button);\n            tr.append(td);\n            \n            $(\"#user_table tbody\").append(tr);\n        });\n\n        $(\"#user_table .delete\").click(function() {\n          var id = $(this).parent(\"td\").parent(\"tr\").data(\"id\");\n          deleteUser(id);\n        })\n    });\n  }\n\n  function deleteUser(user_id) {\n    console.log(user_id);\n    apiRequest(\"POST\", \"deleteUser\", {target_id: user_id}, function(response) {\n      console.log(response);\n      if(response.success) {\n        newAlert($(\"#alert\"), false, response.message);\n        getUserList();\n      } else {\n        newAlert($(\"#alert\"), true, response.message);\n      }\n    });\n  }\n\n  function createUser(formdata) {\n    apiRequest(\"POST\", \"createUser\", formdata, function(response) {\n      if(response.success) {\n        newAlert($(\"#alert\"), false, response.message);\n        getUserList();\n      } else {\n        newAlert($(\"#alert\"), true, response.message);\n      }\n    });\n  }"]}